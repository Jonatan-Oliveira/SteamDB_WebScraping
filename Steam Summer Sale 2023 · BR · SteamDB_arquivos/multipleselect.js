/**
 * @author zhixin wen <wenzhixin2010@gmail.com>
 * @version 1.2.1
 * @license MIT
 *
 * https://github.com/wenzhixin/multiple-select
 *
 * SteamDB: This file has been modified to work with the sales page.
 */(function(i){"use strict";var c=function(e){var s=arguments,t=!0,l=1;return e=e.replace(/%s/g,function(){var n=s[l++];return typeof n>"u"?(t=!1,""):n}),t?e:""};function u(e,s){var t=this,l=e.attr("name")||s.name||"";this.options=s,this.$el=e.hide(),this.$label=this.$el.closest("label"),this.$label.length===0&&this.$el.attr("id")&&(this.$label=i(c('label[for="%s"]',this.$el.attr("id").replace(/:/g,"\\:")))),this.$parent=i(c('<div class="ms-parent %s" %s/>',e.attr("class")||"",c('title="%s"',e.attr("title")))),this.$choice=i(c(['<button class="ms-choice">','<span class="placeholder">%s</span>',"</button>"].join(""),this.options.placeholder)),this.$drop=i(c('<div class="ms-drop %s"></div>',this.options.position)),this.$el.after(this.$parent),this.$parent.append(this.$choice),this.$parent.append(this.$drop),this.$el.prop("disabled")&&this.$choice.addClass("disabled"),this.selectAllName='data-name="selectAll'+l+'"',this.selectGroupName='data-name="selectGroup'+l+'"',this.selectItemName='data-name="selectItem'+l+'"',this.options.keepOpen||i(document.body).on("click",function(n){n.target===t.$choice[0]||i(n.target).parents(".ms-choice")[0]===t.$choice[0]||(n.target===t.$drop[0]||i(n.target).parents(".ms-drop")[0]!==t.$drop[0]&&n.target!==e[0])&&t.options.isOpen&&t.close()})}u.prototype={constructor:u,init:function(){var e=this,s=i("<ul></ul>");this.$drop.html(""),this.options.filter&&this.$drop.append(['<div class="ms-search">','<input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false" placeholder="Search">',"</div>"].join("")),this.options.selectAll&&!this.options.single&&s.append(['<li class="ms-select-all">',"<label>",c('<input type="checkbox" %s /> ',this.selectAllName),this.options.selectAllDelimiter[0],this.options.selectAllText,this.options.selectAllDelimiter[1],"</label>","</li>"].join("")),i.each(this.$el.children(),function(t,l){s.append(e.optionToHtml(t,l))}),s.append(c('<li class="ms-no-results">%s</li>',this.options.noMatchesFound)),this.$drop.append(s),this.$searchInput=this.$drop.find(".ms-search input"),this.$selectAll=this.$drop.find("input["+this.selectAllName+"]"),this.$selectGroups=this.$drop.find("input["+this.selectGroupName+"]"),this.$selectItems=this.$drop.find("input["+this.selectItemName+"]:enabled"),this.$disableItems=this.$drop.find("input["+this.selectItemName+"]:disabled"),this.$noResults=this.$drop.find(".ms-no-results"),this.events(),this.updateSelectAll(!0),this.update(!0),this.options.isOpen&&this.open()},optionToHtml:function(e,s,t,l){var n=this,o=i(s),a=o.attr("class")||"",r=c('title="%s"',o.attr("title")),p=this.options.multiple?"multiple":"",h,f=this.options.single?"radio":"checkbox",m=o.val(),$=n.options.textTemplate(o),g=o.prop("selected")||o.data("selected"),d;return h=l||o.prop("disabled"),d=i([c('<li class="%s %s" %s>',p,a,r),c('<label class="%s">',h?"disabled":""),c('<input type="%s" %s%s%s%s>',f,this.selectItemName,g?' checked="checked"':"",h?' disabled="disabled"':"",c(' data-group="%s"',t)),c("<span>%s</span>",$),"</label>","</li>"].join("")),d.find("input").val(m),d},events:function(){var e=this,s=function(t){t.preventDefault(),e[e.options.isOpen?"close":"open"]()};this.$label&&this.$label.off("click").on("click",function(t){t.target.nodeName.toLowerCase()!=="label"||t.target!==this||(s(t),(!e.options.filter||!e.options.isOpen)&&e.focus(),t.stopPropagation())}),this.$choice.off("click").on("click",s).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur),this.$parent.off("keydown").on("keydown",function(t){switch(t.which){case 27:e.close(),e.$choice.focus();break}}),this.$searchInput.off("keydown").on("keydown",function(t){t.keyCode===9&&t.shiftKey&&e.close()}).off("keyup").on("keyup",function(t){if(e.options.filterAcceptOnEnter&&(t.which===13||t.which==32)&&e.$searchInput.val()){e.$selectAll.click(),e.close(),e.focus();return}}).off("input").on("input",function(t){e.filter()}),this.$selectAll.off("click").on("click",function(){var t=i(this).prop("checked"),l=e.$selectItems.filter(":visible");l.length===e.$selectItems.length?e[t?"checkAll":"uncheckAll"]():(e.$selectGroups.prop("checked",t),l.prop("checked",t),e.options[t?"onCheckAll":"onUncheckAll"](),e.update())}),this.$selectGroups.off("click").on("click",function(){var t=i(this).parent().attr("data-group"),l=e.$selectItems.filter(":visible"),n=l.filter(c('[data-group="%s"]',t)),o=n.length!==n.filter(":checked").length;n.prop("checked",o),e.updateSelectAll(),e.update(),e.options.onOptgroupClick({label:i(this).parent().text(),checked:o,children:n.get(),instance:e})}),this.$selectItems.off("click").on("click",function(){if(e.options.onClick(this),e.updateSelectAll(),e.update(),e.updateOptGroupSelect(),e.options.single&&e.options.isOpen&&!e.options.keepOpen&&e.close(),e.options.single){var t=i(this).val();e.$selectItems.filter(function(){return i(this).val()!==t}).each(function(){i(this).prop("checked",!1)}),e.update()}})},open:function(){if(!this.$choice.hasClass("disabled")){if(this.options.isOpen=!0,this.$drop[this.animateMethod("show")](),this.$selectAll.parent().show(),this.$noResults.hide(),this.$el.children().length||(this.$selectAll.parent().hide(),this.$noResults.show()),this.options.container){var e=this.$drop.offset();this.$drop.appendTo(i(this.options.container)),this.$drop.offset({top:e.top,left:e.left})}this.options.filter&&(this.$searchInput.val(""),this.$searchInput.focus(),this.filter()),this.options.onOpen()}},close:function(){this.options.isOpen=!1,this.$drop[this.animateMethod("hide")](),this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"})),this.options.onClose()},animateMethod:function(e){var s={show:{fade:"fadeIn",slide:"slideDown"},hide:{fade:"fadeOut",slide:"slideUp"}};return s[e][this.options.animate]||e},update:function(e){var s=this.options.displayValues?this.getSelects():this.getSelects("text"),t=this.$choice.find(">span"),l=s.length;l===0?t.addClass("placeholder").html(this.options.placeholder):this.options.allSelected&&l===this.$selectItems.length+this.$disableItems.length?t.removeClass("placeholder").html(this.options.allSelected):this.options.ellipsis&&l>this.options.minimumCountSelected?t.removeClass("placeholder").text(s.slice(0,this.options.minimumCountSelected).join(this.options.delimiter)+"..."):this.options.countSelected&&l>this.options.minimumCountSelected?t.removeClass("placeholder").html(this.options.countSelected.replace("#",s.length).replace("%",this.$selectItems.length+this.$disableItems.length)):t.removeClass("placeholder").html(s.join(this.options.delimiter)),this.options.addTitle&&t.prop("title",this.getSelects("text")),this.$el.val(this.getSelects()).trigger("change"),this.$drop.find("li").removeClass("selected"),this.$drop.find("input:checked").each(function(){i(this).parents("li").first().addClass("selected")})},updateSelectAll:function(e){var s=this.$selectItems;e||(s=s.filter(":visible")),this.$selectAll.prop("checked",s.length&&s.length===s.filter(":checked").length),!e&&this.$selectAll.prop("checked")&&this.options.onCheckAll()},updateOptGroupSelect:function(){var e=this.$selectItems.filter(":visible");i.each(this.$selectGroups,function(s,t){var l=i(t).parent().attr("data-group"),n=e.filter(c('[data-group="%s"]',l));i(t).prop("checked",n.length&&n.length===n.filter(":checked").length)})},getSelects:function(e){var s=this,t=[],l=[];return this.$drop.find(c("input[%s]:checked",this.selectItemName)).each(function(){t.push(i(this).parents("li").find("span").html()),l.push(i(this).val())}),e==="text"&&this.$selectGroups.length&&(t=[],this.$selectGroups.each(function(){var n=[],o=i.trim(i(this).parent().text()),a=i(this).parent().data("group"),r=s.$drop.find(c('[%s][data-group="%s"]',s.selectItemName,a)),p=r.filter(":checked");if(p.length){if(n.push("["),n.push(o),r.length>p.length){var h=[];p.each(function(){h.push(i(this).parent().text())}),n.push(": "+h.join(", "))}n.push("]"),t.push(n.join(""))}})),e==="text"?t:l},setSelects:function(e){var s=this;this.$selectItems.prop("checked",!1),this.$disableItems.prop("checked",!1),i.each(e,function(t,l){s.$selectItems.filter(c('[value="%s"]',l)).prop("checked",!0),s.$disableItems.filter(c('[value="%s"]',l)).prop("checked",!0)}),this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length+this.$disableItems.filter(":checked").length),i.each(s.$selectGroups,function(t,l){var n=i(l).parent().attr("data-group"),o=s.$selectItems.filter('[data-group="'+n+'"]');i(l).prop("checked",o.length&&o.length===o.filter(":checked").length)}),this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")},checkAll:function(){this.$selectItems.prop("checked",!0),this.$selectGroups.prop("checked",!0),this.$selectAll.prop("checked",!0),this.update(),this.options.onCheckAll()},uncheckAll:function(){this.$selectItems.prop("checked",!1),this.$selectGroups.prop("checked",!1),this.$selectAll.prop("checked",!1),this.update(),this.options.onUncheckAll()},focus:function(){this.$choice.focus(),this.options.onFocus()},blur:function(){this.$choice.blur(),this.options.onBlur()},refresh:function(){this.init()},filter:function(){var e=this,s=i.trim(this.$searchInput.val()).toLowerCase();s.length===0?(this.$selectAll.parent().show(),this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show(),this.$noResults.hide()):(this.$selectItems.each(function(){var t=i(this).parent();t[t.text().toLowerCase().indexOf(s)<0?"hide":"show"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){var t=i(this).parent(),l=t.attr("data-group"),n=e.$selectItems.filter(":visible");t[n.filter(c('[data-group="%s"]',l)).length?"show":"hide"]()}),this.$selectItems.parent().filter(":visible").length?(this.$selectAll.parent().show(),this.$noResults.hide()):(this.$selectAll.parent().hide(),this.$noResults.show())),this.updateOptGroupSelect(),this.updateSelectAll(),this.options.onFilter(s)}},i.fn.multipleSelect=function(){var e=arguments[0],s=arguments,t,l=["getSelects","setSelects","enable","disable","open","close","checkAll","uncheckAll","focus","blur","refresh","close"];return this.each(function(){var n=i(this),o=n.data("multipleSelect"),a=i.extend({},i.fn.multipleSelect.defaults,n.data(),typeof e=="object"&&e);if(o||(o=new u(n,a),n.data("multipleSelect",o)),typeof e=="string"){if(i.inArray(e,l)<0)throw"Unknown method: "+e;t=o[e](s[1])}else o.init(),s[1]&&(t=o[s[1]].apply(o,[].slice.call(s,2)))}),typeof t<"u"?t:this},i.fn.multipleSelect.defaults={name:"",isOpen:!1,placeholder:"",selectAll:!0,selectAllDelimiter:["[","]"],minimumCountSelected:3,ellipsis:!1,multiple:!1,single:!1,filter:!1,container:null,position:"bottom",keepOpen:!1,animate:"none",displayValues:!1,delimiter:", ",addTitle:!1,filterAcceptOnEnter:!1,hideOptgroupCheckboxes:!1,selectAllText:"Select all",allSelected:"All selected",countSelected:"# of % selected",noMatchesFound:"No matches found",textTemplate:function(e){return e.html()},labelTemplate:function(e){return e.attr("label")},onOpen:function(){return!1},onClose:function(){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onFocus:function(){return!1},onBlur:function(){return!1},onOptgroupClick:function(){return!1},onClick:function(){return!1},onFilter:function(){return!1}}})(jQuery);
